**API接口文档**

**通用信息**

前缀地址: http://api.edu.eayang.com/api

接口身份验证

请求头中加入: Bearer {token}, token为登录时获取到的token

数据返回格式: application/json

  --------------- --------------- ----------------------------------------
  字段            类型            描述

  code            int             错误码

  message         string          错误描述

  data            mixed           根据接口的不同返回类型不同,
                                  具体类型会在具体接口文档中阐述
  --------------- --------------- ----------------------------------------

Code为0时, 代表接口请求成功

**注意: 接口文档中数据返回格式只描述返回中的data字段,
整体格式与上述数据返回格式**

**教师端**

申请开通学校: POST /teacher/school/apply

请求参数

  ----------------- ----------------- ----------------- -----------------
  参数名            类型              描述              是否必须

  name              string            学校名称          是

  country           string            学校国家          是

  province          string            学校省份          是

  city              string            学校城市          是

  address           string            学校地址          是
  ----------------- ----------------- ----------------- -----------------

返回数据

+-----------------------------------------------------------------------+
| > JSON\                                                               |
| > {\                                                                  |
| > \"code\": 0,\                                                       |
| > \"msg\": \"Success\",\                                              |
| > \"data\": \[\]\                                                     |
| > }                                                                   |
+-----------------------------------------------------------------------+

获取学校申请列表: GET /teacher/school/apply

请求参数

返回数据

+-----------------------------------------------------------------------+
| > JSON\                                                               |
| > {\                                                                  |
| > \"code\": 0,\                                                       |
| > \"msg\": \"Success\",\                                              |
| > \"data\": \[\                                                       |
| > {\                                                                  |
| > \"id\": 2, // 请求id\                                               |
| > \"apply_teacher_id\": 1, // 申请教师id\                             |
| > \"school_id\": 2, // 学校id\                                        |
| > \"status\": 1, // 申请状态, 0待审核, 1同意, 2拒绝\                  |
| > \"created_at\": \"2023-03-29 12:52:31\", // 创建时间\               |
| > \"updated_at\": \"2023-03-29 12:56:43\", // 更新时间\               |
| > \"school\": { // 申请的学校信息\                                    |
| > \"id\": 2, // 学校id\                                               |
| > \"name\": \"厦门一中\", // 学校名\                                  |
| > \"country\": \"中国\", // 学校国家\                                 |
| > \"province\": \"福建\", // 学校\                                    |
| > \"city\": \"厦门\", // 城市\                                        |
| > \"address\": \"思明区\", // 地址\                                   |
| > \"status\": 1, // 状态\                                             |
| > \"created_at\": \"2023-03-29 12:52:31\", // 学校创建时间\           |
| > \"updated_at\": \"2023-03-29 12:56:43\" // 学校更新时间\            |
| > }\                                                                  |
| > },\                                                                 |
| > \]\                                                                 |
| > }                                                                   |
+-----------------------------------------------------------------------+

获取关注我的学生列表: GET /teacher/follower

请求参数

返回数据

+-----------------------------------------------------------------------+
| > JSON\                                                               |
| > {\                                                                  |
| > \"code\": 0,\                                                       |
| > \"msg\": \"Success\",\                                              |
| > \"data\": \[\                                                       |
| > {\                                                                  |
| > \"id\": 2, // 学生id\                                               |
| > \"name\": \"达极\", //学生名\                                       |
| > \"grade\": \"2\", //年段\                                           |
| > \"class\": \"5\", //班级\                                           |
| > \"school\": {\                                                      |
| > \"id\": 1, // 学校id\                                               |
| > \"name\": \"福州一中\", // 学校明名\                                |
| > \"country\": \"中国\", // 学校国家\                                 |
| > \"province\": \"福建\", // 学校省份\                                |
| > \"city\": \"福州\", // 学校城市\                                    |
| > \"address\": \"仓山区\", // 学校地址\                               |
| > \"status\": 1, // 学校状态\                                         |
| > \"created_at\": \"2023-03-29 07:55:08\",\                           |
| > \"updated_at\": \"2023-03-29 07:57:38\"\                            |
| > }\                                                                  |
| > }\                                                                  |
| > \]\                                                                 |
| > }                                                                   |
+-----------------------------------------------------------------------+

获取管理的学校列表: GET /teacher/admin/school

请求参数

返回数据

+-----------------------------------------------------------------------+
| > JSON\                                                               |
| > {\                                                                  |
| > \"code\": 0,\                                                       |
| > \"msg\": \"Success\",\                                              |
| > \"data\": \[\                                                       |
| > {\                                                                  |
| > \"id\": 1, // 学校id\                                               |
| > \"name\": \"福州一中\", // 学校明名\                                |
| > \"country\": \"中国\", // 学校国家\                                 |
| > \"province\": \"福建\", // 学校省份\                                |
| > \"city\": \"福州\", // 学校城市\                                    |
| > \"address\": \"仓山区\", // 学校地址\                               |
| > \"status\": 1, // 学校状态\                                         |
| > \"created_at\": \"2023-03-29 12:52:31\",\                           |
| > \"updated_at\": \"2023-03-29 12:56:43\"\                            |
| > }\                                                                  |
| > \]\                                                                 |
| > }                                                                   |
+-----------------------------------------------------------------------+

获取管理的学生列表: GET /teahcer/admin/student

请求参数

返回数据

+-----------------------------------------------------------------------+
| > JSON\                                                               |
| > {\                                                                  |
| > \"code\": 0,\                                                       |
| > \"msg\": \"Success\",\                                              |
| > \"data\": \[\                                                       |
| > {\                                                                  |
| > \"student\": {\                                                     |
| > \"id\": 1, // 学生id\                                               |
| > \"name\": \"肖及巴\", // 学生名\                                    |
| > \"grade\": \"2\", // 年段\                                          |
| > \"class\": \"2\", // 班级\                                          |
| > \"avatar\": \"\", //头像\                                           |
| > \"role\": \"student\" // 角色\                                      |
| > },\                                                                 |
| > \"school\": {\                                                      |
| > \"id\": 1, // 学校id\                                               |
| > \"name\": \"福州一中\", // 学校明名\                                |
| > \"country\": \"中国\", // 学校国家\                                 |
| > \"province\": \"福建\", // 学校省份\                                |
| > \"city\": \"福州\", // 学校城市\                                    |
| > \"address\": \"仓山区\", // 学校地址\                               |
| > }\                                                                  |
| > }\                                                                  |
| > \]\                                                                 |
| > }                                                                   |
+-----------------------------------------------------------------------+

获取同学校学生列表: GET /teacher/student

请求参数

返回数据

+-----------------------------------------------------------------------+
| > JSON\                                                               |
| > {\                                                                  |
| > \"code\": 0,\                                                       |
| > \"msg\": \"Success\",\                                              |
| > \"data\": \[\                                                       |
| > {\                                                                  |
| > \"student\": {\                                                     |
| > \"id\": 1, // 学生id\                                               |
| > \"name\": \"肖及巴\", // 学生名\                                    |
| > \"grade\": \"2\", // 年段\                                          |
| > \"class\": \"2\", // 班级\                                          |
| > \"avatar\": \"\", //头像\                                           |
| > \"role\": \"student\" // 角色\                                      |
| > },\                                                                 |
| > \"school\": {\                                                      |
| > \"id\": 1, // 学校id\                                               |
| > \"name\": \"福州一中\", // 学校明名\                                |
| > \"country\": \"中国\", // 学校国家\                                 |
| > \"province\": \"福建\", // 学校省份\                                |
| > \"city\": \"福州\", // 学校城市\                                    |
| > \"address\": \"仓山区\", // 学校地址\                               |
| > }\                                                                  |
| > }\                                                                  |
| > \]\                                                                 |
| > }                                                                   |
+-----------------------------------------------------------------------+

新建学生: GET /teacher/student

请求参数

  ----------------- ----------------- ----------------- -----------------
  参数名            类型              描述              是否必须

  schoolId          string            学校id            是

  name              string            学生名字          是

  grade             string            年段              是

  class             string            班级              是

  username          string            用户名            是

  password          string            密码              是
  ----------------- ----------------- ----------------- -----------------

返回数据

+-----------------------------------------------------------------------+
| > JSON\                                                               |
| > {\                                                                  |
| > \"code\": 0,\                                                       |
| > \"msg\": \"Success\",\                                              |
| > \"data\": \[\]\                                                     |
| > }                                                                   |
+-----------------------------------------------------------------------+

邀请老师加入学校: POST /teacher/invite

请求参数

  ---------------- ---------------- -------------------- ----------------
  参数名           类型             描述                 是否必须

  email            string           邀请教师的邮箱号     是

  schoolId         int              学校id               是
  ---------------- ---------------- -------------------- ----------------

返回数据

+-----------------------------------------------------------------------+
| > JSON\                                                               |
| > {\                                                                  |
| > \"code\": 0,\                                                       |
| > \"msg\": \"Success\",\                                              |
| > \"data\": \[\]\                                                     |
| > }                                                                   |
+-----------------------------------------------------------------------+

检查教师邀请并加入学校: GET /teacher/join
(邮箱内点击获取复制出来访问的地址)

请求参数

  ---------------- ---------------- -------------------- ----------------
  参数名           类型             描述                 是否必须

  email            string           邀请教师的邮箱号     是

  schoolId         int              学校id               是

  code             string           邀请码               是
  ---------------- ---------------- -------------------- ----------------

返回数据

+-----------------------------------------------------------------------+
| > JSON\                                                               |
| > {\                                                                  |
| > \"code\": 0,\                                                       |
| > \"msg\": \"Success\",\                                              |
| > \"data\": \[\]\                                                     |
| > }                                                                   |
+-----------------------------------------------------------------------+

**学生端**

获取教师列表: GET /student/teacher

请求参数

返回数据

+-----------------------------------------------------------------------+
| > JSON\                                                               |
| > {\                                                                  |
| > \"code\": 0,\                                                       |
| > \"msg\": \"Success\",\                                              |
| > \"data\": \[\                                                       |
| > {\                                                                  |
| > \"id\": 1, // 教师id\                                               |
| > \"name\": \"一号测试教师\", // 教师名\                              |
| > \"avatar\": \"\", // 教师头像\                                      |
| > \"role\": \"teacher\", // 教师角色\                                 |
| > \"isAdmin\": false, // 是否是管理员\                                |
| > \"school\": \"福州一中\", // 教师所在学校\                          |
| > \"followed\": true // 是否关注\                                     |
| > }\                                                                  |
| > \]\                                                                 |
| > }                                                                   |
+-----------------------------------------------------------------------+

关注教师: GET /student/follow

请求参数

返回数据

+-----------------------------------------------------------------------+
| > JSON\                                                               |
| > {\                                                                  |
| > \"code\": 0,\                                                       |
| > \"msg\": \"Success\",\                                              |
| > \"data\": \[\]\                                                     |
| > }                                                                   |
+-----------------------------------------------------------------------+

取消关注教师: GET /student/unfollow

请求参数

返回数据

+-----------------------------------------------------------------------+
| > JSON\                                                               |
| > {\                                                                  |
| > \"code\": 0,\                                                       |
| > \"msg\": \"Success\",\                                              |
| > \"data\": \[\]\                                                     |
| > }                                                                   |
+-----------------------------------------------------------------------+

获取关注的教师列表: GET /student/follow/teacher

请求参数

返回数据

+-----------------------------------------------------------------------+
| > JSON\                                                               |
| > {\                                                                  |
| > \"code\": 0,\                                                       |
| > \"msg\": \"Success\",\                                              |
| > \"data\": \[\                                                       |
| > {\                                                                  |
| > \"id\": 1, // 教师id\                                               |
| > \"name\": \"一号测试教师\", // 教师名\                              |
| > \"avatar\": \"\", // 教师头像\                                      |
| > \"role\": \"teacher\", // 教师角色\                                 |
| > \"isAdmin\": false, // 是否是管理员\                                |
| > \"school\": \"福州一中\", // 教师所在学校\                          |
| > \"followed\": true // 是否关注\                                     |
| > }\                                                                  |
| > \]\                                                                 |
| > }                                                                   |
+-----------------------------------------------------------------------+

**登录注册相关**

教师注册: POST /register

请求参数

  ---------------- ---------------- -------------------- ----------------
  参数名           类型             描述                 是否必须

  email            string           教师的邮箱号         是

  password         string           密码                 是

  name             string           名字                 是
  ---------------- ---------------- -------------------- ----------------

返回数据

+-----------------------------------------------------------------------+
| > JSON\                                                               |
| > {\                                                                  |
| > \"code\": 0,\                                                       |
| > \"msg\": \"Success\",\                                              |
| > \"data\": {\                                                        |
| > \"token\": \"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1N\...\...\", //        |
| > 身份token\                                                          |
| > \"user\": {\                                                        |
| > \"id\": 14, // 用户id\                                              |
| > \"name\": \"盛大的撒\", // 用户名\                                  |
| > \"avatar\": \"\", // 头像\                                          |
| > \"role\": \"teacher\", // 角色\                                     |
| > \"isAdmin\": false // 是否管理员\                                   |
| > }\                                                                  |
| > }\                                                                  |
| > }                                                                   |
+-----------------------------------------------------------------------+

用户登录: POST /login

请求参数

  ---------------- ---------------- ------------------------ ----------------
  参数名           类型             描述                     是否必须

  username         string           教师邮箱或者学生用户名   是

  password         string           密码                     是

  role             string           角色: 教师teacher,       是
                                    学生student              
  ---------------- ---------------- ------------------------ ----------------

返回数据

+-----------------------------------------------------------------------+
| > JSON\                                                               |
| > {\                                                                  |
| > \"code\": 0,\                                                       |
| > \"msg\": \"Success\",\                                              |
| > \"data\": {\                                                        |
| > \"token\": \"eyJ0eXAiOiJKV1QiLCJhbG\.....\", // 身份token\          |
| > \"user\": {\                                                        |
| > \"id\": 2, // 用户id\                                               |
| > \"name\": \"达极\", // 用户名\                                      |
| > \"grade\": \"2\", // 年段\                                          |
| > \"class\": \"5\", // 班级\                                          |
| > \"avatar\": \"\", // 头像\                                          |
| > \"role\": \"student\" // 角色\                                      |
| > }\                                                                  |
| > }\                                                                  |
| > }                                                                   |
+-----------------------------------------------------------------------+

获取第三方登录授权地址: GET /oauth/login

请求参数

  ---------------- ---------------- -------------------- ----------------
  参数名           类型             描述                 是否必须

  loginType        string           第三方登录方式: line 是
  ---------------- ---------------- -------------------- ----------------

返回数据

+-----------------------------------------------------------------------+
| > JSON\                                                               |
| > {\                                                                  |
| > \"code\": 0,\                                                       |
| > \"msg\": \"Success\",\                                              |
| > \"data\": {\                                                        |
| > \"url\":                                                            |
| > \"https://access.line.me/oauth2/v2.1/authorize?                     |
| response_type=code&client_id=1660794617&redirect_uri=http%3A%2F%2F127 |
| .0.0.1%3A8000%2Fapi%2Fline%2Fauth&state=6424eaaf6acd2&scope=profile\" |
| > // 授权地址\                                                        |
| > }\                                                                  |
| > }                                                                   |
+-----------------------------------------------------------------------+

第三方登录: GET /oauth/auth

请求参数

  ---------------- ---------------- -------------------- ----------------
  参数名           类型             描述                 是否必须

  loginType        string           第三方登录方式: line 是

  code             string           第三方用户授权code   是
  ---------------- ---------------- -------------------- ----------------

返回数据

+-----------------------------------------------------------------------+
| > JSON\                                                               |
| > {\                                                                  |
| > \"code\": 0,\                                                       |
| > \"msg\": \"Success\",\                                              |
| > \"data\": {\                                                        |
| > \"token\": \"eyJ0eXAiOiJKV1QiLCJhbGci\...\", // 身份token\          |
| > \"user\": {\                                                        |
| > \"id\": 48, // 用户id\                                              |
| > \"name\": \"\", // 用户名\                                          |
| > \"role\": \"oauth\" // 角色\                                        |
| > }\                                                                  |
| > }\                                                                  |
| > }                                                                   |
+-----------------------------------------------------------------------+

绑定第三方登录用户与系统用户: POST /oauth/bind/user

> **注意, 此接口带的Authorization值须为第三方登录获取到的token**

请求参数

  ---------------- ---------------- ------------------------ ----------------
  参数名           类型             描述                     是否必须

  username         string           教师邮箱或者学生用户名   是

  password         string           密码                     是

  role             string           角色: 教师teacher,       是
                                    学生student              
  ---------------- ---------------- ------------------------ ----------------

返回数据

+-----------------------------------------------------------------------+
| > JSON\                                                               |
| > {\                                                                  |
| > \"code\": 0,\                                                       |
| > \"msg\": \"Success\",\                                              |
| > \"data\": \[\]\                                                     |
| > }                                                                   |
+-----------------------------------------------------------------------+

获取绑定的系统用户: GET /oauth/bind/user

**注意, 此接口带的Authorization值须为第三方登录获取到的token**

请求参数

返回数据

+-----------------------------------------------------------------------+
| > JSON\                                                               |
| > {\                                                                  |
| > \"code\": 0,\                                                       |
| > \"msg\": \"Success\",\                                              |
| > \"data\": {\                                                        |
| > \"student\": \[\                                                    |
| > {\                                                                  |
| > \"id\": 1, // 用户id\                                               |
| > \"name\": \"肖及\", // 用户名\                                      |
| > \"grade\": \"2\", // 年段\                                          |
| > \"class\": \"2\", // 班级\                                          |
| > \"avatar\": \"\", // 头像\                                          |
| > \"role\": \"student\" // 角色\                                      |
| > },\                                                                 |
| > {\                                                                  |
| > \"id\": 2,\                                                         |
| > \"name\": \"达极\",\                                                |
| > \"grade\": \"2\",\                                                  |
| > \"class\": \"5\",\                                                  |
| > \"avatar\": \"\",\                                                  |
| > \"role\": \"student\"\                                              |
| > }\                                                                  |
| > \],\                                                                |
| > \"teacher\": \[\                                                    |
| > {\                                                                  |
| > \"id\": 1, // 用户id\                                               |
| > \"name\": \"一号测试教师\", // 用户名\                              |
| > \"avatar\": \"\", // 头像\                                          |
| > \"role\": \"teacher\", // 角色\                                     |
| > \"isAdmin\": false // 管理员\                                       |
| > }\                                                                  |
| > \]\                                                                 |
| > }\                                                                  |
| > }                                                                   |
+-----------------------------------------------------------------------+

切换到绑定的用户: POST /oauth/user/switch

> **注意, 此接口带的Authorization值须为第三方登录获取到的token**

请求参数

  ---------------- ---------------- ------------------------ ----------------
  参数名           类型             描述                     是否必须

  userId           int              需要切换的哟筽那个户id   是

  role             string           角色: 教师teacher,       是
                                    学生student              
  ---------------- ---------------- ------------------------ ----------------

返回数据

+-----------------------------------------------------------------------+
| > JSON\                                                               |
| > {\                                                                  |
| > \"code\": 0,\                                                       |
| > \"msg\": \"Success\",\                                              |
| > \"data\": {\                                                        |
| > \"token\": \"eyJ0eXAiOiJKV1QiLCJhbGciOi\.....\", // 身份token\      |
| > \"user\": {\                                                        |
| > \"id\": 1, // 用户id\                                               |
| > \"name\": \"肖及\", // 用户名\                                      |
| > \"avatar\": \"\", // 头像\                                          |
| > \"role\": \"student\" // 角色\                                      |
| > }\                                                                  |
| > }\                                                                  |
| > }                                                                   |
+-----------------------------------------------------------------------+

获取用户信息: GET /user/info

请求参数

返回数据

+-----------------------------------------------------------------------+
| > JSON\                                                               |
| > {\                                                                  |
| > \"code\": 0,\                                                       |
| > \"msg\": \"Success\",\                                              |
| > \"data\": {\                                                        |
| > \"user\": {\                                                        |
| > \"id\": 1, // 用户id\                                               |
| > \"name\": \"肖及\", // 用户名\                                      |
| > \"avatar\": \"\", // 头像\                                          |
| > \"role\": \"student\" // 角色\                                      |
| > }\                                                                  |
| > }\                                                                  |
| > }                                                                   |
+-----------------------------------------------------------------------+

登出: POST /logout

请求参数

返回数据

+-----------------------------------------------------------------------+
| > JSON\                                                               |
| > {\                                                                  |
| > \"code\": 0,\                                                       |
| > \"msg\": \"Success\",\                                              |
| > \"data\": \[\]\                                                     |
| > }                                                                   |
+-----------------------------------------------------------------------+

**Websocket聊天接入说明**

地址: ws://47.243.117.37:18000

创建连接时, 需要带上token参数(即登录后获得的身份令牌)以及对方的用户id

  ---------------- ---------------- -------------------- ----------------
  参数名           类型             描述                 是否必须

  token            string           身份令牌             是

  userId           int              通信的用户id         是
  ---------------- ---------------- -------------------- ----------------

服务端会根据token进行鉴权判断是否能建立连接

消息发送格式: json

  -----------------------------------------------------------------------
  JSON\
  {\
  \"event\": \"chat\",\
  \"msg\": \"\", // 根据event的不同而有不同含义\
  }

  -----------------------------------------------------------------------

消息中event及相关描述

  ----------------------- ----------------------- -----------------------
  event                   作用                    msg

  heartbeat               心跳检测,               不需要msg
                          不做任何逻辑处理        

  chat                    发送消息                要发送的消息
  ----------------------- ----------------------- -----------------------

**错误码**

  ----------------------------------- -----------------------------------
  event                               作用

  *0*                                 成功

  100400                              请求参数错误

  100500                              服务器错误

  100501                              登录失败

  100                                 学生未找到

  200                                 教师未找到

  201                                 不是管理员, 禁止操作

  202                                 验证码错误

  203                                 创建新教师失败

  300                                 学校未找到

  400                                 关注教师失败

  401                                 取消关注教师失败
  ----------------------------------- -----------------------------------
